{layout '../layouts/base.latte'}

{block title}MyCloud{/block}
{block head}{/block}
{block nav}
<nav class="navbar is-primary" role="navigation" aria-label="main navigation">
  <div class="navbar-menu"> 
    <div class="navbar-start"> 
      {* <a class="navbar-item">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</a>  *}
    </div> 
    <div class="navbar-item is-expanded is-justify-content-center">
  <div class="navbar-brand"> 
    <a class="navbar-item" href="/"> <strong>MyCloud</strong> </a> 
  </div> 
    </div> 
    <div class="navbar-end"> 
      <a class="navbar-item">ğŸ”” é€šçŸ¥</a> 
      <a class="navbar-item">ğŸ‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</a> 
    </div> 
  </div>
</nav>
{/block}
{block content}
  <section>
  <div class="has-background-primary p-2" style="display: flex; align-items: center; justify-content: space-between;">
  <!-- å·¦å´ï¼šã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚¢ã‚¤ã‚³ãƒ³ -->
  <div class="is-flex is-align-items-center" style="gap: 0.5rem;">
  {=renderComponent('breadcrumbs',['breadcrumbs' => $breadcrumbs])|noescape}
  </div>
  <div> 
    <sl-input placeholder="æ¤œç´¢..." clearable size="small"> 
      <sl-icon slot="prefix" name="search" size="small"></sl-icon> 
    </sl-input>
  </div>  
  <!-- å³å´ï¼šãƒ„ãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ -->
  <div class="is-flex is-align-items-center" style="gap: 0.5rem;">
    <sl-icon-button name="folder-plus" label="ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ" id="create-folder-btn"></sl-icon-button>
    <sl-icon-button name="trash" label="å‰Šé™¤"></sl-icon-button>
  </div>
  </div>
    <div class="container" style="border:1px solid grey">
      <div class="icon-grid">
      {foreach $folders as $folder}
        <div class="icon-item">
          <sl-icon-button
            name="folder"
            label="{$folder->name}"
            onclick="location.href = '/folders/{$currentPath}/{$folder->name}'">
          </sl-icon-button>
          <div>{$folder->name}</div>
        </div>
      {/foreach}
      {foreach $files as $file}
  <div class="icon-item" oncontextmenu="showProperties(event, '{$file->logical_name}', {$file->versions|json_encode|noescape})">
    <sl-icon-button
      name="{getIconName($file->versions[0]->mime_type)}"
      label="{$file->logical_name}"
      onclick="location.href = '/view/{$file->versions[0]->id}'">
    </sl-icon-button>
    <div>{$file->logical_name}</div>
  </div>
{/foreach}
      </div>
    </div>
  </section>
  <!-- ãƒ€ã‚¤ã‚¢ãƒ­ã‚° --> 
<sl-dialog label="æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ" id="folder-dialog">
  <sl-input 
    id="folder-name" 
    label="ãƒ•ã‚©ãƒ«ãƒ€åã‚’å…¥åŠ›" 
    placeholder="ä¾‹: æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€" 
    help-text="" 
    pill 
    clearable>
  </sl-input>
  <sl-button slot="footer" variant="primary" id="create-btn">ä½œæˆ</sl-button>
  <sl-button slot="footer" variant="text" id="cancel-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</sl-button>
</sl-dialog>
{/block}
{block scripts}
<script n:syntax="off">
  function showProperties(event, name, versions) {
    event.preventDefault();
    const latest = versions[0];
    const versionList = versions.map(v =>
      `v${v.version} - ${v.size} bytes - ${new Date(v.uploaded_at).toLocaleString()}`
    ).join('\n');
    alert(`ğŸ“„ ${name}\n\nVersions:\n${versionList}`);
  }
</script>
<script n:syntax="off">
document.addEventListener('DOMContentLoaded', async () => {
  const dialog = document.getElementById('folder-dialog');
  const openBtn = document.getElementById('create-folder-btn');
  const cancelBtn = document.getElementById('cancel-btn');
  const createBtn = document.getElementById('create-btn');
  const input = document.getElementById('folder-name');
  const forbiddenChars = /[<>:"/\\|?*]/;

  openBtn.addEventListener('click', () => {
    console.log("c")
    input.value = '';
    input.setAttribute('help-text', '');
    input.removeAttribute('variant');
    dialog.show();
  });

  cancelBtn.addEventListener('click', () => {
    dialog.hide();
  });

  createBtn.addEventListener('click', () => {
    const folderName = input.value;

    if (forbiddenChars.test(folderName)) {
      input.setAttribute('help-text', 'ãƒ•ã‚©ãƒ«ãƒ€åã«ä½¿ç”¨ã§ããªã„æ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™: < > : " / \\ | ? *');
      input.setAttribute('variant', 'danger');
    } else if (folderName.trim() === '') {
      input.setAttribute('help-text', 'ãƒ•ã‚©ãƒ«ãƒ€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      input.setAttribute('variant', 'danger');
    } else {
      console.log('ä½œæˆã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€å:', folderName);
      input.setAttribute('help-text', '');
      input.removeAttribute('variant');
      dialog.hide();
    }
  });
  // âŒ¨ï¸ Enterã‚­ãƒ¼ã§ä½œæˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ 
  input.addEventListener('keydown', (event) => { 
    if (event.key === 'Enter') { 
      createBtn.click(); 
    } 
  });
});
</script>

{/block}
